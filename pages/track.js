import Head from "next/head";
import { Header } from "../components/Header";
import { Footer } from "../components/Footer";
import { useWorkItemContext } from "../contexts/workItemProvider";
import { EditWorkItem } from "../components/EditWorkItem";
import { AddWorkItem } from "../components/AddWorkItem";
import { useOverlayContext } from "../contexts/overlayProvider";
import { SearchableTable } from "../components/SearchableTable";
import { useTrackItemContext } from "../contexts/trackItemProvider";

export default function Track() {
  //import workitemprovider and distrubte to table components
  const [workItemList, insertWorkItem, setWorkItemList, updateWorkItem] =
    useWorkItemContext();

  const [trackItemList, insertTrackItem] = useTrackItemContext();

  const [
    isOverlayOpen,
    openOverlay,
    closeOverlay,
    isTableEditMode,
    handleEditButtonClick,
    initialAddValue,
    isEditMode,
    setIsEditMode,
    handleEditButtonSingleItemClick,
  ] = useOverlayContext();

  const countSelected = workItemList.filter((item) => item.isChecked === true);

  return (
    <>
      <Head>
        <title>Track</title>
        <meta name="description" content="Generated by create next app" />
        <link rel="icon" href="/favicon.ico" />
      </Head>
      <Header header="Track work"></Header>
      <div style={{ display: "flex" }}>
        <button onClick={openOverlay} disabled={isOverlayOpen}>
          Add
        </button>
        <EditWorkItem
          handleClick={handleEditButtonClick}
          isOverlayOpen={isOverlayOpen}
        />
      </div>
      {isOverlayOpen ? (
        <div style={{ position: "relative", backgroundColor: "black" }}>
          <AddWorkItem
            initialAddValue={isEditMode ? initialAddValue : null}
            handleCloseClick={closeOverlay}
            isEditMode={isEditMode}
          />
        </div>
      ) : null}

      <SearchableTable
        data={workItemList}
        setData={setWorkItemList}
        hasCheckbox={true}
        width={"100%"}
        isTableEditMode={isTableEditMode}
        handleEditItemClick={handleEditButtonSingleItemClick}
        isOverlayOpen={isOverlayOpen}
      ></SearchableTable>
      {countSelected.length ? (
        <button
          onClick={() => {
            insertTrackItem(countSelected);
          }}
        >
          Add to tracker
        </button>
      ) : null}
      <Footer></Footer>
    </>
  );
}
